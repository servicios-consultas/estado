<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Consulta de Infracciones | Buenos Aires</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

  <style>
    body { background-color: #f5f5f5; }
    .infraccion-header { display:flex; align-items:flex-start; }
    .infraccion-header input { margin-top:6px; }
  </style>
</head>

<body>

<!-- HEADER -->
<header class="bg-white border-bottom">
  <div class="container">
        <a class="navbar-brand" href="https://www.buenosaires.gob.ar/">
          <img class="header-logo" src="./assets/img/logoBA.svg" alt="Ciudad de buenos aires">
        </a>
        <div class="navbar-search d-responsive ml-auto">
          <form class="form-search form-search-sm">
            <div class="form-group">
              <input type="search" class="form-control form-control-sm input-search" name="header-search" aria-label="Ingrese su búsqueda" placeholder="Buscar...">
              <button class="reset" type="reset"></button>
            </div>
          </form>
        </div>
        <button class="navbar-toggler collapsed ml-2" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false">
          Menú
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="list-group-content d-responsive ml-2">
          <a href="#" aria-label="Cerrar sesión" class="list-group-item list-group-item-logout logout-sm">
            &nbsp;
          </a>
        </div>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="nav nav-pills">
            <li class="nav-item">
              <a href="https://buenosaires.gob.ar" class="nav-link active"><span>Inicio</span></a>
            </li>
            <li class="nav-item d-responsive">
              <div class="navbar-search">
                <form class="form-search form-search-sm">
                  <div class="form-group">
                    <input type="search" class="form-control form-control-sm input-search" id="buscador-texto" name="header-search" aria-label="Ingrese su búsqueda" placeholder="Buscar...">
                    <button class="reset" type="reset"></button>
                  </div>
                </form>
              </div>
            </li>
          </ul>
        </div>
</header>

<!-- CONTENIDO -->
<main class="container my-5">

<form onsubmit="event.preventDefault(); consultar();">

<div class="card p-4 mb-4">
  <h3 class="mb-3">Quiero datos sobre</h3>

  <!-- RADIOS -->
  <div class="d-flex">
    <div class="custom-control custom-radio mr-4">
      <input class="custom-control-input" type="radio" name="tipo_consulta" id="radioDominio">
      <label class="custom-control-label" for="radioDominio">Una patente</label>
    </div>

    <div class="custom-control custom-radio">
      <input class="custom-control-input" type="radio" name="tipo_consulta" id="radioDocumento" checked>
      <label class="custom-control-label" for="radioDocumento">Un documento</label>
    </div>
  </div>

  <!-- DOCUMENTO -->
  <div class="row mt-3" id="panel-documento">
    <div class="form-group col-12 col-lg-4">
      <label>Tipo de documento*</label>
      <select class="custom-select">
        <option>CI</option>
        <option>CUIT</option>
        <option selected>DNI</option>
        <option>EXT</option>
        <option>LC</option>
        <option>LE</option>
        <option>PAS</option>
      </select>
    </div>

    <div class="form-group col-12 col-lg-6">
      <label>Número de documento*</label>
      <input type="number" class="form-control" id="inputDni">
    </div>
  </div>

  <!-- DOMINIO -->
  <div class="row mt-3 d-none" id="panel-dominio">
    <div class="form-group col-12 col-lg-6">
      <label>Dominio*</label>
      <input type="text" class="form-control" id="inputDominio">
    </div>
  </div>

  <!-- CAPTCHA -->
  <div class="mt-3">
    <div class="g-recaptcha" data-sitekey="6LfcRGAlAAAAAJI0S2ABpxX_Wj56oioSE6y393OG"></div>
  </div>

  <div class="text-right mt-4">
    <button class="btn btn-primary btn-lg">Consultar</button>
  </div>
</div>

</form>

<!-- RESULTADOS -->
<div id="resultados" class="d-none">

  <div class="card p-4 mb-4">
    <h3>Datos ingresados</h3>
    <small id="tipoConsulta"></small>
    <h6 id="valorConsulta"></h6>
  </div>

  <h4 id="totalInfracciones"></h4>
  <div id="listaInfracciones"></div>

  <div class="card p-3 mt-3">
    <span id="totalActas">(0 actas seleccionadas)</span>
    <h4 id="totalMonto">$0</h4>
    <span>Puntos a descontar: <strong id="totalPD">0</strong></span><br>
    <span>Puntos a reasignar: <strong id="totalPR">0</strong></span>
  </div>

  <div class="text-right mt-3">
    <button id="btnPagar" class="btn btn-primary btn-lg" disabled>Pagar seleccionadas</button>
  </div>

</div>

</main>

<!-- FOOTER -->
<footer class="bg-light pt-5">
  <div class="container text-center">
    <small>Contenidos licenciados bajo Creative Commons</small>
  </div>
</footer>

<!-- FUNCIONALIDAD -->
<script>
const personasDB = [{
  dni:"30123456",
  dominios:["HFD310","AA123BB"],
  infracciones:[
    { acta:"A01458963", tipo:"Exceso de velocidad", fecha:"15/09/2024", lugar:"Av. Gral Paz", puntosD:5, puntosR:0, monto:25000 }
  ]
}];

let infraccionesActuales=[];

function consultar(){
  const esDominio = radioDominio.checked;
  const dominio = inputDominio.value.toUpperCase().trim();
  const dni = inputDni.value.trim();

  if(esDominio && !dominio) return alert("Ingresá una patente");
  if(!esDominio && !dni) return alert("Ingresá un DNI");

  const persona = personasDB.find(p => esDominio ? p.dominios.includes(dominio) : p.dni===dni);
  if(!persona) return alert("No se encontraron infracciones");

  infraccionesActuales = persona.infracciones;
  resultados.classList.remove("d-none");
  tipoConsulta.innerText = esDominio ? "Patente" : "DNI";
  valorConsulta.innerText = esDominio ? dominio : dni;

  render();
}

function render(){
  listaInfracciones.innerHTML="";
  totalInfracciones.innerText = `Infracciones: ${infraccionesActuales.length}`;

  infraccionesActuales.forEach((i,idx)=>{
    listaInfracciones.innerHTML+=`
    <div class="card mb-3">
      <div class="card-header infraccion-header">
        <input type="checkbox" data-i="${idx}" onchange="calcular()">
        <div class="ml-3">
          <strong>${i.acta}</strong><br>${i.tipo}
        </div>
      </div>
      <div class="card-body">
        <p>${i.lugar}</p>
        <h4>$${i.monto.toLocaleString("es-AR")}</h4>
      </div>
    </div>`;
  });
}

function calcular(){
  let total=0,pd=0,pr=0,c=0;
  document.querySelectorAll("#listaInfracciones input").forEach(ch=>{
    if(ch.checked){
      const i=infraccionesActuales[ch.dataset.i];
      total+=i.monto; pd+=i.puntosD; pr+=i.puntosR; c++;
    }
  });
  totalMonto.innerText=`$${total.toLocaleString("es-AR")}`;
  totalPD.innerText=pd;
  totalPR.innerText=pr;
  totalActas.innerText=`(${c} actas seleccionadas)`;
  btnPagar.disabled=c===0;
}

radioDominio.onclick=()=>{panelDominio.classList.remove("d-none");panelDocumento.classList.add("d-none");}
radioDocumento.onclick=()=>{panelDocumento.classList.remove("d-none");panelDominio.classList.add("d-none");}
</script>

<script src="https://www.google.com/recaptcha/api.js?hl=es"></script>
</body>
</html>
