<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Consulta de Infracciones | Buenos Aires</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

  <style>
    body { background-color: #f5f5f5; }
    .card-header button { all: unset; width: 100%; cursor: pointer; }
    .infraccion-header { display:flex; align-items:flex-start; }
    .infraccion-header input { margin-top:6px; }
  </style>
</head>

<body>

<!-- HEADER / NAVBAR -->
<header class="bg-white border-bottom">
  <div class="container d-flex align-items-center py-2">
    <a class="navbar-brand" href="https://www.buenosaires.gob.ar/">
      <img class="header-logo" src="https://buenosaires.gob.ar/licenciasdeconducir/consulta-de-infracciones/assets/img/logoBA.svg" alt="Ciudad de Buenos Aires">
    </a>
  </div>
</header>

<!-- CONTENIDO PRINCIPAL -->
<main class="container my-5">

  <!-- FORMULARIO -->
  <div class="card p-4 mb-4">
    <h3 class="mb-3">Quiero datos sobre</h3>

    <!-- RADIOS -->
    <div class="d-flex">
      <div class="custom-control custom-radio mr-4">
        <input class="custom-control-input" type="radio" name="tipo_consulta" id="radioDominio" checked>
        <label class="custom-control-label" for="radioDominio">Una patente</label>
      </div>

      <div class="custom-control custom-radio">
        <input class="custom-control-input" type="radio" name="tipo_consulta" id="radioDocumento">
        <label class="custom-control-label" for="radioDocumento">Un documento</label>
      </div>
    </div>

    <!-- PANEL DOMINIO -->
    <div class="row mt-3" id="panel-dominio">
      <div class="form-group col-12 col-lg-6">
        <label>Dominio*</label>
        <input type="text" class="form-control" id="inputDominio">
      </div>
      <small class="col-12">Ingresá la patente sin espacios.</small>
    </div>

    <!-- PANEL DOCUMENTO -->
    <div class="row mt-3 d-none" id="panel-documento">
      <div class="form-group col-12 col-lg-4">
        <label>Tipo de documento*</label>
        <select class="custom-select" name="tipo_doc">
          <option>CI</option>
          <option>CUIT</option>
          <option selected>DNI</option>
          <option>EXT</option>
          <option>LC</option>
          <option>LE</option>
          <option>PAS</option>
        </select>
      </div>

      <div class="form-group col-12 col-lg-6">
        <label>Número de documento*</label>
        <input type="number" class="form-control" id="inputDni">
      </div>

      <small class="col-12">
        Si tu DNI es menor a 10.000.000 utilizá LE o LC.
        <a href="https://buenosaires.gob.ar/terminos-y-condiciones-consulta-de-infracciones">
          Ver términos y condiciones
        </a>
      </small>
    </div>

    <div class="text-right mt-4">
      <button type="button" class="btn btn-primary btn-lg" onclick="consultar()">Consultar</button>
    </div>
  </div>

  <!-- RESULTADOS -->
  <div id="resultados" class="d-none">

    <div class="card p-4 mb-4">
      <h3>Datos ingresados</h3>
      <small id="tipoConsulta"></small>
      <h6 id="valorConsulta"></h6>
    </div>

    <h2>Tus infracciones</h2>
    <h6 id="totalInfracciones"></h6>

    <div id="listaInfracciones"></div>

    <!-- RESUMEN -->
    <div class="card p-3 mt-3">
      <span id="totalActas">(0 actas seleccionadas)</span>
      <h4 id="totalMonto">$0</h4>
      <span>Puntos a descontar: <strong id="totalPD">0</strong></span><br>
      <span>Puntos a reasignar: <strong id="totalPR">0</strong></span>
    </div>

    <div class="text-right mt-3">
      <button id="btnPagar" class="btn btn-primary btn-lg" disabled>
        Pagar seleccionadas
      </button>
    </div>

  </div>

</main>

<!-- FOOTER -->
<footer class="main-footer pie-final bg-light pt-5">
  <div class="container">
    <section>
      <h4>Teléfonos útiles</h4>
      <ul class="list-inline">
        <li class="list-inline-item"><a href="tel:102">102 - Niñez</a></li>
        <li class="list-inline-item"><a href="tel:103">103 - Emergencias</a></li>
        <li class="list-inline-item"><a href="tel:107">107 - SAME</a></li>
        <li class="list-inline-item"><a href="tel:911">911 - Policía</a></li>
        <li class="list-inline-item"><a href="tel:144">144 - Violencia de género</a></li>
        <li class="list-inline-item"><a href="tel:147">147 - Atención ciudadana</a></li>
      </ul>
    </section>

    <hr>

    <section class="text-center">
      <small>
        Los contenidos de buenosaires.gob.ar están licenciados bajo Creative Commons.
      </small>
    </section>
  </div>
</footer>

<!-- FUNCIONALIDAD BÚSQUEDA / INFRACCIONES -->
<script>
/* ============ BASE DE DATOS SIMULADA ============ */
const personasDB = [
  {
    dni: "30123456",
    dominios: ["HFD310","AA123BB"],
    infracciones: [
      {
        acta: "G02829771",
        tipo: "Forzar barrera / evadir pago de peaje",
        fecha: "08/08/2024 14:22",
        lugar: "AU Dellepiane Km 0.5",
        puntosD: 0,
        puntosR: 0,
        monto: 0,
        foto: "https://tu-dominio.com/G02829771.jpg"
      },
      {
        acta: "A01458963",
        tipo: "Exceso de velocidad",
        fecha: "15/09/2024 09:10",
        lugar: "Av. Gral Paz Km 12",
        puntosD: 5,
        puntosR: 0,
        monto: 25000,
        foto: "https://tu-dominio.com/A01458963.jpg"
      }
    ]
  }
];

/* ============ VARIABLES GLOBALES ============ */
let infraccionesActuales = [];

/* ============ FUNCIONES ============ */
function consultar() {
  const esDominio = document.getElementById("radioDominio").checked;
  const dominio = document.getElementById("inputDominio").value.trim().toUpperCase();
  const dni = document.getElementById("inputDni").value.trim();

  if (esDominio && dominio === "") { alert("Ingresá un dominio"); return; }
  if (!esDominio && dni === "") { alert("Ingresá un DNI"); return; }

  const persona = personasDB.find(p =>
    esDominio ? p.dominios.includes(dominio) : p.dni === dni
  );

  if (!persona) {
    alert("No se encontraron infracciones");
    return;
  }

  infraccionesActuales = persona.infracciones;

  document.getElementById("resultados").classList.remove("d-none");
  document.getElementById("tipoConsulta").innerText = esDominio ? "Patente" : "DNI";
  document.getElementById("valorConsulta").innerText = esDominio ? dominio : dni;

  renderInfracciones();
}

function renderInfracciones() {
  const cont = document.getElementById("listaInfracciones");
  cont.innerHTML = "";
  document.getElementById("totalInfracciones").innerText = `Infracciones totales: ${infraccionesActuales.length}`;

  infraccionesActuales.forEach((i, idx) => {
    cont.innerHTML += `
      <div class="card mb-3">
        <div class="card-header infraccion-header">
          <input type="checkbox" data-i="${idx}" onchange="calcular()">
          <div class="ml-3">
            <strong>Acta ${i.acta}</strong>
            <div>${i.tipo}</div>
            <small>${i.fecha}</small>
          </div>
        </div>
        <div class="card-body">
          <p><strong>Lugar:</strong> ${i.lugar}</p>
          <p><strong>Puntos a descontar:</strong> ${i.puntosD}</p>
          <p><strong>Puntos a reasignar:</strong> ${i.puntosR}</p>
          <h4>$${i.monto.toLocaleString("es-AR")}</h4>
          <a href="${i.foto}" target="_blank" class="btn btn-secondary btn-sm">Descargar foto</a>
        </div>
      </div>
    `;
  });
  calcular();
}

function calcular() {
  let total = 0, pd = 0, pr = 0, c = 0;
  document.querySelectorAll("#listaInfracciones input[type=checkbox]").forEach(chk => {
    if (chk.checked) {
      const i = infraccionesActuales[chk.dataset.i];
      total += i.monto;
      pd += i.puntosD;
      pr += i.puntosR;
      c++;
    }
  });

  document.getElementById("totalActas").innerText = `(${c} actas seleccionadas)`;
  document.getElementById("totalMonto").innerText = `$${total.toLocaleString("es-AR")}`;
  document.getElementById("totalPD").innerText = pd;
  document.getElementById("totalPR").innerText = pr;
  document.getElementById("btnPagar").disabled = c === 0;
}

/* ============ TOGGLE DNI / DOMINIO ============ */
const panelDominio = document.getElementById("panel-dominio");
const panelDocumento = document.getElementById("panel-documento");

document.getElementById("radioDominio").onclick = () => {
  panelDominio.classList.remove("d-none");
  panelDocumento.classList.add("d-none");
};

document.getElementById("radioDocumento").onclick = () => {
  panelDocumento.classList.remove("d-none");
  panelDominio.classList.add("d-none");
};
</script>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://www.google.com/recaptcha/api.js?hl=es"></script>
</body>
  </html>
